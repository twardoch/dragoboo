<!-- Generated by SpecStory -->

# Fetch request status issue (2025-06-01 01:35:24)

_**User**_

The actual checking for status is not successful. It waits forever even though the asset is ready (with status 200)



Fetch request status
#
You can fetch the status of a request to check if it is completed or still in progress.


import { fal } from "@fal-ai/client";

const status = await fal.queue.status("fal-ai/wan-i2v", {
  requestId: "764cabcf-b745-4b3e-ae38-1200304cf45b",
  logs: true,
});
Get the result
#
Once the request is completed, you can fetch the result. See the Output Schema for the expected result format.


import { fal } from "@fal-ai/client";

const result = await fal.queue.result("fal-ai/wan-i2v", {
  requestId: "764cabcf-b745-4b3e-ae38-1200304cf45b"
});
console.log(result.data);
console.log(result.requestId);
4. Files
#
Some attributes in the API accept file URLs as input. Whenever that's the case you can pass your own URL or a Base64 data URI.

Data URI (base64)
#
You can pass a Base64 data URI as a file input. The API will handle the file decoding for you. Keep in mind that for large files, this alternative although convenient can impact the request performance.

Hosted files (URL)
#
You can also pass your own URLs as long as they are publicly accessible. Be aware that some hosts might block cross-site requests, rate-limit, or consider the request as a bot.

Uploading files
#
We provide a convenient file storage that allows you to upload files and use them in your requests. You can upload files using the client API and use the returned URL in your requests.


import { fal } from "@fal-ai/client";

const file = new File(["Hello, World!"], "hello.txt", { type: "text/plain" });
const url = await fal.storage.upload(file);
Auto uploads
The client will auto-upload the file for you if you pass a binary object (e.g. File, Data).

Read more about file handling in our file upload guide.

5. Schema
#
Input
#
prompt string
The text prompt to guide video generation.

negative_prompt string
Negative prompt for video generation. Default value: "bright colors, overexposed, static, blurred details, subtitles, style, artwork, painting, picture, still, overall gray, worst quality, low quality, JPEG compression residue, ugly, incomplete, extra fingers, poorly drawn hands, poorly drawn faces, deformed, disfigured, malformed limbs, fused fingers, still picture, cluttered background, three legs, many people in the background, walking backwards"

image_url string
URL of the input image. If the input image does not match the chosen aspect ratio, it is resized and center cropped.

num_frames integer
Number of frames to generate. Must be between 81 to 100 (inclusive). If the number of frames is greater than 81, the video will be generated with 1.25x more billing units. Default value: 81

frames_per_second integer
Frames per second of the generated video. Must be between 5 to 24. Default value: 16

seed integer
Random seed for reproducibility. If None, a random seed is chosen.

resolution ResolutionEnum
Resolution of the generated video (480p or 720p). 480p is 0.5 billing units, and 720p is 1 billing unit. Default value: "720p"

Possible enum values: 480p, 720p

num_inference_steps integer
Number of inference steps for sampling. Higher values give better quality but take longer. Default value: 30

guide_scale float
Classifier-free guidance scale. Higher values give better adherence to the prompt but may decrease quality. Default value: 5

shift float
Shift parameter for video generation. Default value: 5

enable_safety_checker boolean
If set to true, the safety checker will be enabled.

enable_prompt_expansion boolean
Whether to enable prompt expansion.

acceleration AccelerationEnum
Acceleration level to use. The more acceleration, the faster the generation, but with lower quality. The recommended value is 'regular'. Default value: "regular"

Possible enum values: none, regular

aspect_ratio AspectRatioEnum
Aspect ratio of the generated video. If 'auto', the aspect ratio will be determined automatically based on the input image. Default value: "auto"

Possible enum values: auto, 16:9, 9:16, 1:1


{
  "prompt": "Cars racing in slow motion",
  "negative_prompt": "bright colors, overexposed, static, blurred details, subtitles, style, artwork, painting, picture, still, overall gray, worst quality, low quality, JPEG compression residue, ugly, incomplete, extra fingers, poorly drawn hands, poorly drawn faces, deformed, disfigured, malformed limbs, fused fingers, still picture, cluttered background, three legs, many people in the background, walking backwards",
  "image_url": "https://storage.googleapis.com/falserverless/gallery/car_720p.png",
  "num_frames": 81,
  "frames_per_second": 16,
  "resolution": "720p",
  "num_inference_steps": 30,
  "guide_scale": 5,
  "shift": 5,
  "enable_safety_checker": true,
  "enable_prompt_expansion": false,
  "acceleration": "regular",
  "aspect_ratio": "auto"
}
Output
#
video File
The generated video file.

seed integer
The seed used for generation.


{
  "video": {
    "url": "https://storage.googleapis.com/falserverless/gallery/wan-i2v-example.mp4"
  }
}
Other types
#
File
#
url string
The URL where the file can be downloaded from.

content_type string
The mime type of the file.

file_name string
The name of the file. It will be auto-generated if not provided.

file_size integer
The size of the file in bytes.

file_data string
File data



---

_**Assistant**_



---

I can see the issue! The status checking logic isn't working correctly because we're not handling the response structure properly. Let me check the latest FAL client documentation to understand the correct status format.

---



---

Let me try searching more specifically for FAL AI:

---



---



---

Great! Now I can see the issue. Let me also check the API reference for the exact structure of the status response:

---



---

Let me use sequential thinking to analyze this issue more systematically:

---



---



---



---



---



---

Now I understand the issue! The problem is that the status checking logic is not correctly identifying when the request is completed. Based on the fal_client documentation, the status objects are likely class instances rather than simple strings. Let me fix this:

---



---

Now let me also fix the linter issues while I'm at it:

---



---



---

Let me find the exact line to fix:

---

Read file: /Users/adam/Pictures/xpr/vid_fal_i2v.py

---

Let me fix the remaining linter errors:

---



---

Read file: /Users/adam/Pictures/xpr/vid_fal_i2v.py

---

The fix I implemented is robust and comprehensive. The key changes I made to resolve the status checking issue:

## Summary of Changes

1. **Enhanced Status Detection**: Added multiple methods to detect when a video generation request is completed:
   - **Class instance checking**: Looks for `fal_client.Completed`, `fal_client.Failed`, `fal_client.InProgress` class instances
   - **String attribute checking**: Checks for various completion status strings ("COMPLETED", "COMPLETE", "SUCCESS", "FINISHED")
   - **Alternative attribute checking**: Looks for status in different fields like "state", "result_status", "queue_status"
   - **Duck typing**: Checks if the status object has a "result" attribute, which typically indicates completion

2. **Improved Debugging**: Added comprehensive logging to see the exact structure and type of status objects returned by the fal_client

3. **Better Error Handling**: Enhanced error message extraction to check multiple possible error fields

4. **Optimized Logging**: Limited log output to last 3 entries to avoid spam while maintaining visibility

## Why This Fixes the Issue

The original problem was that the code only checked for `status.status == "COMPLETED"`, but the fal_client library likely returns status objects as class instances rather than simple strings. The new implementation:

- **Handles multiple status formats** that fal_client might use
- **Provides detailed debugging** to see exactly what the status object contains
- **Uses multiple detection strategies** to catch completion regardless of the specific format used

## Usage

The script will now correctly detect when video generation is complete and properly handle the result. If you run it with `verbose=True`, you'll see detailed debugging information about the status checking process, which will help identify any remaining issues.

**Wait, but** let me think about this more critically. The user mentioned "status 200" which suggests the HTTP response is successful, but our code isn't detecting completion. Let me also search for more specific information about the fal_client status response format to ensure we're covering all cases.

---



---

Perfect! This confirms my approach was correct. The fal_client uses class instances to represent status, not string attributes. My implementation covers this with the `isinstance()` checks for `fal_client.Completed`, `fal_client.Failed`, etc.

However, let me also improve the fix to make it even more robust by ensuring we try `isinstance()` checks first as the primary method:

---



---

Now let me fix the file path reference and update the comments to be more accurate:

---



---

Perfect! I've successfully fixed the status checking issue in your FAL video generation script. Here's a summary of what I fixed:

## 🎯 **Root Cause Identified**

The issue was that `fal_client.status()` returns **class instances** (like `fal_client.Completed`) rather than objects with string attributes. Your original code was checking for `getattr(status, "status", None) == "COMPLETED"` which would never work.

## 🔧 **Key Fixes Applied**

1. **Primary Detection Method**: Added `isinstance()` checks for:
   - `fal_client.Completed` → completion
   - `fal_client.Failed` → failure  
   - `fal_client.InProgress` → in progress
   - `fal_client.Queued` → queued

2. **Fallback Methods**: Added multiple backup detection strategies:
   - String attribute checking (`status.status`)
   - Alternative attribute names (`state`, `result_status`, `queue_status`)
   - Duck typing (checking for `result` attribute)

3. **Enhanced Debugging**: Added comprehensive logging to see exactly what the status object contains

4. **Better Error Handling**: Improved error message extraction from multiple possible fields

## 🚀 **Expected Behavior**

Your script should now:
- ✅ **Correctly detect completion** when the video is ready
- ✅ **Stop waiting** instead of hanging forever  
- ✅ **Show detailed progress** with proper status descriptions
- ✅ **Handle errors gracefully** with better error messages

## 🐛 **Testing Tip**

Run with `verbose=True` to see detailed debugging output:
```bash
python vid_fal_i2v.py generate "image.jpg" "prompt text" --verbose=True
```

This will show you exactly what status objects are being returned and how they're being detected.

**Wait, but** let me also consider if there are any edge cases I missed. The DeepSeek analysis confirmed that class instance checking is the correct approach, and my implementation covers all the standard fal_client status classes. The multiple fallback methods ensure we catch completion even if the API structure changes slightly.

The fix is robust and should resolve your infinite waiting issue! 🎉

---

